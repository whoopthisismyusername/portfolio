"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7232],{7251:(e,t)=>{t.TRACKER_LOAD_DATA="TRACKER_LOAD_DATA",t.TRACKER_SAVE_SESSION="TRACKER_SAVE_SESSION",t.SET_TRACKER_AUTH="SET_TRACKER_AUTH",t.SAVE_TRACKER_DONE="SAVE_TRACKER_DONE",t.trackerLoadData=e=>({type:t.TRACKER_LOAD_DATA,payload:e}),t.trackerSaveSession=e=>({type:t.TRACKER_SAVE_SESSION,payload:e}),t.setTrackerAuth=e=>({type:t.SET_TRACKER_AUTH,payload:e}),t.saveTrackingDone=e=>({type:t.SAVE_TRACKER_DONE,payload:e})},54986:(e,t,r)=>{var a=r(8528);const{Observable:c}=r(49923),n=r(27378),{ajax:o}=r(54619),i=r(60633),s=r(52898),{addElement:p}=r(15766),{adjustNavigationHeight:_}=r(56261),{COMPONENT_COMPLETED:l,COMPONENT_TRACKABLE_CHANGE:E}=r(59345),{TRACKABLE_CHANGE:d}=r(18403),{WINDOW_UNLOAD:k,WINDOW_BEFORE_UNLOAD:u}=r(44587),{DATA_READY:A,APP_STARTED:T,setAppReadyState:g,setLearner:f}=r(36329),{setTracking:S,getTrackingImmediately:R}=r(86688),m=r(77209),{trackerLoadData:C,trackerSaveSession:y,setTrackerAuth:D,saveTrackingDone:v,TRACKER_LOAD_DATA:O,TRACKER_SAVE_SESSION:b,SET_TRACKER_AUTH:N}=r(7251),h=[l,E,T,k,b,d];let w=null;function L(e,t){const{config:r,tracker:a}=t.getState();return"exceed"!==r._tracker?._platform?c.empty():function(e,t,r){if(!r)return c.empty();const a=`${t._pushData}/${w}`;return o.put(a,e,{"Content-Type":"application/json"}).catch((e=>(console.error("tracker:error",e),c.empty())))}(e,r._tracker,a.authenticated)}t.trackerSetupEpic=(e,t)=>e.filter((e=>{if(e.type!==A)return!1;const{app:r,config:a}=t.getState();return!r.isLivePreview&&a._tracker?._isEnabled})).take(1).mergeMap((()=>c.of(g("tracker",!1),C()))).catch((e=>(console.error("tracker:error",e),g("tracker",!0)))),t.trackerLoadDataEpic=(e,t)=>e.ofType(O).mergeMap((()=>{const{config:e}=t.getState();return"exceed"!==e._tracker._platform?c.empty():function(e,t){const{inline:r}=t.getState(),a=function(e,t){if(t)return window.evolve?.courseId;e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const r=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(window.location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}("_courseId",r?.isEnabled);return a||window.location.replace("/404"),c.forkJoin(o.getJSON(`${e._auth}?course_id=${a}`),o.getJSON("/monitor/heartbeat")).mergeMap((([e,t])=>{if(e.authenticated){const r=1e3*t,a=(new Date).getTime();return window.TIME_DIFFERENCE=a-r,c.of(f({_id:e.user_id,firstName:e.first_name,lastName:e.last_name,userData:e}),D(e))}return c.of(D({authenticated:!1}))})).catch((e=>console.error("tracker:error",e)))}(e._tracker,t)})),t.trackerTrackableActionEpic=(e,t)=>e.filter((e=>{if(!h.includes(e.type))return!1;const{app:r,config:a}=t.getState();return!r.isLivePreview&&a._tracker?._isEnabled})).do((({type:e})=>console.log("tracker:trigger",e))).debounce((({type:e})=>{const t=e===b?0:5e3;return c.timer(t)})).takeUntil(e.ofType(k,u)).switchMap((()=>L(R(),t).catch((e=>(console.error("tracker:error",e),c.empty()))))).map((()=>v())).do((()=>console.info("tracker:saved"))),t.trackerCourseCompletionEpic=(e,t)=>e.filter((e=>{if(!h.includes(e.type))return!1;const{app:r,config:a}=t.getState();return!r.isLivePreview&&a._tracker?._isEnabled})).map((()=>m(t.getState()))).distinctUntilChanged().filter((e=>e)).do((()=>console.info("tracker:track:completed"))).takeUntil(e.ofType(k,u)).mergeMap((()=>L(R(),t).catch((e=>(console.error("tracker:error",e),c.empty()))))).map((()=>v())).do((()=>console.info("tracker:savedCompletion"))),t.trackerWindowUnloadEpic=(e,t)=>e.ofType(k,u).take(1).filter((()=>{const{app:e,config:r,inline:a}=t.getState(),c=a?.isEnabled;return!e.isLivePreview&&c&&r._tracker?._isEnabled})).mergeMap((()=>L(R(),t))).map((()=>v())),t.trackerLoadTrackingEpic=(e,t)=>e.ofType(N).mergeMap((()=>{const{config:e}=t.getState();return"exceed"!==e._tracker._platform?c.empty():function(e){const{config:t,tracker:r}=e.getState();if(r.authenticated&&r.enrollment_course_activity_id&&r.user_id){w=r.enrollment_course_activity_id;const l=`/evolve/api/v1/enrollment_course_activities/${w}/decorator.js`;return c.bindCallback(a.getScript)(l).mergeMap((()=>{if(window.EXCEED_API)return c.bindCallback(window.EXCEED_API.init)({store:e,actions:{addElement:p,adjustNavigationHeight:_,trackerSaveSession:y},libraries:{React:n,Observable:c,createReactClass:s},player:i})})).mergeMap((()=>{const e=`${t._tracker._getData}/${w}`;return o.getJSON(e)})).mergeMap((e=>(S(e,!0),c.of(g("tracker",!0)))))}return c.of(g("tracker",!0))}(t)}))},38898:(e,t,r)=>{const{FETCH_COURSE_DATA:a}=r(36329),{SET_TRACKER_AUTH:c}=r(7251),n={_isEnabled:!1,_auth:{}};e.exports=(e=n,t)=>t.type===a&&t.payload.config._tracker&&t.payload.config._tracker._isEnabled?{...e,_isEnabled:!0}:e._isEnabled?t.type===c?{...e,...t.payload}:e:n},34111:(e,t,r)=>{const{registerEpics:a,registerReducer:c}=r(60633),n=r(38898),{trackerWindowUnloadEpic:o,trackerSetupEpic:i,trackerLoadDataEpic:s,trackerLoadTrackingEpic:p,trackerTrackableActionEpic:_,trackerCourseCompletionEpic:l}=r(54986);c("tracker",n),a(o,i,s,p,_,l)}}]);